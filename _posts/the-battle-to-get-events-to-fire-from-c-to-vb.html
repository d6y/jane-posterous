title: The battle to get events to fire from C# to VB
date: 2005/12/07 10:26:00 -0800
tags: [{"name":"Development","id":3773165}]
author: Jane Dallaway
alias: /the-battle-to-get-events-to-fire-from-c-to-vb

I've been battling for ages to get an event raised in .NET 2 to fire in VB6.  After a lot of searching, and huffing and puffing I finally found <a href="http://www.csharphelp.com/archives/archive281.html">this resource</a> which was the only example which seemed to do what I needed to do, i.e. raise an event AND call a method for the same COM component.<p />The code in C# is as follows:<br /><span class="code"><br />using System;<br />using System.Collections.Generic;<br />using System.Text;<br />using System.IO;<br />using System.Runtime.InteropServices;<p />namespace ComEventTest2<br />{<br />    public delegate void TestEventHandler();<p />    #region interface defining events<br />    /// This is the interface for the Event<br />    /// It will be used with ComSourceInterfaces for the class definition<br />    [ComVisible(true)]<br />    [InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIDispatch)]<br />    public interface IClass1_Event<br />    {<br />        void Test();        <br />    }<br />    #endregion<p />    #region interface normal stuff<br />    /// This is the interface for other methods etc which are to be exposed to the<br />    /// consuming program<br />    [ComVisible(true)]    <br />    [InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIDispatch)]<br />    public interface IClass1_Code<br />    {        <br />        void DoSomething();<br />    }<br />    #endregion<p />    #region class<p />    /// This is the class<br />    /// It implements IClass1_Code<br />    /// It uses ComSourceInterfaces to specify which events are valid<br />    /// It sets ClassInterface to be None to prevent any other methods from<br />    /// being displayed in the consuming program<br />    [ClassInterface(ClassInterfaceType.None)] <br />    [ComVisible(true)]<br />    [ComSourceInterfaces(typeof(IClass1_Event))]  <br />    public class Class1 : IClass1_Code<br />    {<br />        public Class1()<br />        {<br />        }<p />        public event TestEventHandler Test;<p />                public void DoSomething()<br />        {<br />            Test();<br />        }<br />    }<br />    #endregion<br />}<p /></span><p />The code within VB is as follows:<br /><span class="code"><br />'Define the object<br />Dim WithEvents test As ComEventTest2.Class1<p />Private Sub Form_Load()<p />        'initialise the objects<br />    Set test = New ComEventTest2.Class1<p />        'call the DoSomething method (this fires the event)<br />    test.DoSomething<p />        End Sub<p />Private Sub test_Test()<p />    'Let us know that the event was fired and captured ok<br />    MsgBox "The event has fired"<p />End Sub<br /></span><p />Now to get it to work for real against VBA in an Access interface.  Wish me luck!<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-113397664760141477?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
