title: Scripting out object level SQL
date: 2008/06/16 10:43:00 -0700
tags: [{"name":"SQLServer","id":58677954}]
author: Jane Dallaway
alias: /scripting-out-object-level-sql

In SQL Server 2000 Enterprise Manager provided the ability to output SQL file on an object level for tables, functions, stored procedures etc.  In SQL Server 2005 this option disapeared and the only outputting was in a single file.  This wasn't great for controlling objects within a source control system.<p />A while ago I <a href="http://weblogs.sqlteam.com/billg/archive/2005/11/22/8414.aspx">stumbled across</a> <a href="http://www.sqlteam.com/publish/scriptio/">Scriptio</a>, a ClickOnce application to do just this.  It has a very simple interface, and you can tell that it was designed to solve a problem, rather than as an end solution.<p /><h2>Tab One - Database Objects</h2><p /><div class='p_embed p_image_embed'>
<img alt="Media_httpfarm4static_rmeif" height="414" src="/media/getfile/files.posterous.com/import-wdma/mGFcGvbnlBclGwjszggypylcGbtDJhwDbooyqwyBFfbJCjgkoJvsaavEHmwB/media_httpfarm4static_rmeIF.jpg.scaled500.jpg" width="500" />
</div>
<p />To get a list of database objects, enter a Server name, select either Use Windows Authentication or enter a Username and password and press Connect.  This should populate the Database drop down.  Select a database and the bottom section should be populated with the objects that are scriptable within your database.  From here, it is a simple case of selecting the appropriate options from the top right hand section (Include CREATE, Include DROP etc) and selecting the appropriate objects from the bottom section (there is a handy Script All option which selects everything.  I have never been able to get the Schema or Type drop downs to populate, which may be something to do with the design of my objects.<p /><h2>Tab Two - More Options</h2><p /><div class='p_embed p_image_embed'>
<img alt="Media_httpfarm4static_cdrab" height="414" src="/media/getfile/files.posterous.com/import-wdma/rAJpBbECteAeFrBGrzGbIICaofqqfsGolhoyfFBGxFBkarfAAxtAFpAyznEj/media_httpfarm4static_cdrab.jpg.scaled500.jpg" width="500" />
</div>
<p />The options tab allows choices of how many files to create (or even if you want to create a file), where to store them and some additional scripting objects (Include collation, Qualify CREATEs with Schema etc).<p /><h2>Tab Three - Generated Script</h2><p /><div class='p_embed p_image_embed'>
<img alt="Media_httpfarm4static_zjlzd" height="414" src="/media/getfile/files.posterous.com/import-wdma/wtGrtjlBDGqxivBJfhrgeJcavFGqGwuGqAHdypqBcGfxCIGDqwHGHiIaayCs/media_httpfarm4static_zJlzd.jpg.scaled500.jpg" width="500" />
</div>
<p />This tab displays the SQL generated - in an single box, allowing the content to be copied to clipboard and used elsewhere.  Just as an observation, I've never seen the "Save As..." button enabled but I've never needed to use it either so that hasn't been a problem.<p /><h2>Sample script - a table</h2><p /><span class="code">IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Book]') AND type in (N'U'))<br />DROP TABLE [dbo].[Book]<br />GO<p />/****** Object:  Table [dbo].[Book]    Script Date: 06/16/2008 17:30:18 ******/<br />SET ANSI_NULLS ON<br />SET QUOTED_IDENTIFIER ON<br />GO<br />CREATE TABLE [dbo].[Book](<br />[Id] [int] IDENTITY(1,1) NOT NULL,<br />[Title] [varchar](255) COLLATE Latin1_General_CI_AS NOT NULL,<br />[Author] [varchar](255) COLLATE Latin1_General_CI_AS NOT NULL,<br />[PublisherId] [int] NULL,<br />[ISBN] [varchar](25) COLLATE Latin1_General_CI_AS NULL,<br />[PublishedYear] [int] NULL,<br />[BookAgeId]  AS (case datepart(year,getdate())-[PublishedYear] when (0) then (1) when (1) then (2) else (3) end)<br />) ON [PRIMARY]<p />GO</span><p /><h2>Sample script - a stored procedure</h2><p /><span class="code">IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[up_GetBooks]') AND type in (N'P', N'PC'))<br />DROP PROCEDURE [dbo].[up_GetBooks]<br />GO<p /><br />/****** Object:  StoredProcedure [dbo].[up_GetBooks]    Script Date: 06/16/2008 17:30:19 ******/<br />SET ANSI_NULLS ON<br />SET QUOTED_IDENTIFIER ON<br />GO<br />-- =============================================<br />-- Author: Jane Dallaway<br />-- Create date: 12 June 2008<br />-- Description: Get all books, in full detail<br />-- =============================================<br />CREATE PROCEDURE up_GetBooks<br />AS<br />BEGIN<br />SET NOCOUNT ON;<p />SELECT Book.Id, Book.Title, Book.Author, Publisher.Name, Book.ISBN, Book.PublishedYear, BookAge.Name BookAge<br />FROM Book<br />INNER JOIN BookAge<br />ON Book.BookAgeId = BookAge.Id<br />INNER JOIN Publisher<br />ON Book.PublisherId = Publisher.Id<p />END<p />GO</span><p /><h2>Summary</h2><p />This is a great utility to allow scripting on an object by object basis.  The <a href="http://weblogs.sqlteam.com/billg/archive/2005/12/24/8613.aspx">source code</a> is available too.<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-7808158941910090899?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
