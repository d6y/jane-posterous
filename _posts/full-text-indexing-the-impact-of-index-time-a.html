title: Full Text Indexing - the impact of index time and query time language choice
date: 2008/07/28 09:30:00 -0700
tags: [{"name":"localisation","id":3772654},{"name":"SQLServer","id":58646395}]
author: Jane Dallaway
alias: /full-text-indexing-the-impact-of-index-time-a

Following on from my <a href="http://jane.dallaway.com/blog/2008/07/more-on-sql-server-2005-full-text-index.html">More on SQL Server 2005 Full Text Index Service</a> post the other day, I thought I'd give an example of how it works<br /><h2>Setup</h2><br />I created a table LanguageData which consisted of 2 fields liID and sValue<p /><span class="code">CREATE TABLE [dbo].[LanguageData]<br />(<br />&nbsp;&nbsp;[ID] [int] IDENTITY(1,1) NOT NULL,<br />&nbsp;&nbsp;[Value] [nvarchar](50) NOT NULL,<br />&nbsp;&nbsp;CONSTRAINT [PK_LanguageData] PRIMARY KEY CLUSTERED<br />&nbsp;&nbsp;(<br />&nbsp;&nbsp;[ID] ASC<br />&nbsp;&nbsp;) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]<br />) ON [PRIMARY]</span><p />I entered some sample data as follows<p /><span class="code">INSERT INTO [LanguageData](Value)<br />SELECT 'the' UNION <br />SELECT 'przed' UNION <br />SELECT 'jakby' </span><p />where 'the' is featured in the English and Neutral language noise word files, 'przed' and 'jakby' are in the Polish language noise files.  Note: You'll need to have <a href="http://msdn.microsoft.com/en-us/library/ms345188.aspx">installed the Polish full text index</a> to make this work.<p />Next enable the full text indexing on the database<p /><span class="code">sp_fulltext_database 'enable'</span><p />and then create a full text catalog and an index for the table LanguageData <p /><span class="code">CREATE FULLTEXT CATALOG LanguageData AS DEFAULT<br />CREATE FULLTEXT INDEX ON LanguageData ([Value] LANGUAGE 1045 )<br />KEY INDEX [PK_LanguageData]</span><p />where 1045 indicates the language Polish - retrieved from <br /><span class="code">SELECT alias, lcid FROM Sys.syslanguages<br />WHERE alias = 'Polish'</span><p /><h2>Scenarios</h2><br />Now, time to run some tests, <p />1) Check that all is initially correct, get everything<p /><span class="code">SELECT * FROM LanguageData</span><p />which returns 3 rows, as expected<p />2) Get everything which matches the noise word 'jakby'<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*,'jakby')</span><p />returns no rows as the word 'jakby' was stripped out at index time, and is also stripped out at query time, and a warning message "Informational: The full-text search condition contained noise word(s)."<p />3) Get everything which matches the noise word 'jakby' specifying Polish (1045) in the CONTAINS clause<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jakby', language 1045 )</span><p />returns no rows as the word 'jakby' was stripped out at index time, and is also stripped out at query time, and a warning message "Informational: The full-text search condition contained noise word(s)."<p />4) Get everything which matches the word 'jakby' specifying US English (1033) in the CONTAINS clause<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jakby', language 1033 )</span><p />returns no rows as the word 'jakby' was stripped out at index time.  No warning message is displayed though as 'jakby' is not a noise word for US English<p />5) Get everything which matches the word 'the'<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the')</span><p />returns one row, as 'the' isn't a noise word in Polish and so wasn't stripped out at index time or at query time<p />6)  Get everything which matches the word 'the' specifying Polish in the CONTAINS clause<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the', language 1045 )</span><p />returns one row, as 'the' isn't a noise word in Polish and so wasn't stripped out at index time or at query time<p />7)  Get everything which matches the word 'the' specifying US English in the CONTAINS clause<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the', language 1033 )</span><p />returns no rows as 'the' is a noise word in US English and therefore is excluded at query time.  A warning message "Informational: The full-text search condition contained noise word(s)." is displayed<p />Now to make it more interesting, lets add some data which combines noise words with normal words<p /><span class="code">INSERT INTO [LanguageData] (Value)<br />VALUES<br />('jakby przed the test')</span><br />which includes 2 polish noise words, one english noise word and one remaining word<p />8) Get everything which matches the word 'jakby'<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jakby')</span><p />returns no rows as the word 'jakby' was stripped out at index time, and is also stripped out at query time, and a warning message "Informational: The full-text search condition contained noise word(s)."  is displayed<p />9) Get everything which matches the word 'the' <p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the')</span><p />returns 2 rows, both the individual 'the' entry and the new 'jakby przed the test' rows.  No message is displayed.<p />10) Get everything which matches the word 'the' using an explicit query language of Polish<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the', language 1045)</span><p />returns 2 rows, both the individual 'the' entry and the new 'jakby przed the test' rows.  No message is displayed.<p />11) Get everything which matches the word 'the' using an explicit query language of English<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'the', language 1033 )</span><p />returns no rows as the word 'the' was stripped at query time according to the noise words for 1033.  A warning message "Informational: The full-text search condition contained noise word(s)."  is displayed<p />And then to make it even more interesting, lets add a new word 'jane' to the LanguageData dataset, and to the noisewords file for the Neutral language (LCID 0) which (on my machine at least) is at C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\FTData\noiseNEU.txt<p />To get the full text indexing service to pick up the changes to the noise files, you need to restart the service via the Control Panel -> Administrative Tools -> Service dialog<p /><span class="code">INSERT INTO LanguageData (Value)<br />VALUES ('jane')<p />12) Get everything which matches the word 'jane' using the implicit query language (Polish)<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jane')</span><p />which returns 1 row, as 'jane' isn't a polish noise word and wasn't stripped out at either index or query time<p />13) Get everything which matches the word 'jane' using the explicit query language English<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jane', language 1033 )</span><p />which returns 1 row, as 'jane' isn't a polish noise word and so wasn't stripped out an index time, neither is it an english noise word so isn't stripped out at query time either<p />14) Get everything which matches the word 'jane' using the explicit query language Neutral<p /><span class="code">SELECT * FROM LanguageData<br />WHERE CONTAINS(*, 'jane', language 0 )</span><p />which returns 0 rows as 'jane' is a neutral noise word and so is stripped out at index time.  A warning message "Informational: The full-text search condition contained noise word(s)."  is displayed<p /><h2>Summary</h2><br />What this shows, is that when you choose a language to set your full text index up as, this impacts the words which will be stripped out of the index as anything defined as noise will be removed.  This has an impact on the choice of language when different language content is being indexed as we need to be clear that what is one languages noise word, isn't another ones non-noise word.  <ul><li>When querying a full text index, it is possible to specify that the query you are running is for a particular language, but if you do and if the language is different to that you set the index up as, then you'll remove 2 sets of noise words from your search - both those that were set up when the index was defined, but also those based on the language specified in the query</li><li>The noise files are defined on an instance by instance basis and so any alterations to the noise file will affect all full text indexes on an instance.</li><li>To pick up changes to the noise files, the service needs to be restarted.</li><li>SQL Server 2008 seems to change this and so more research will be required - it relies on STOPLISTs instead.</li></ul><div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-4569045812533794298?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div></span>
