title: TSQLUnit Updates - Helper Functions
date: 2008/04/09 06:57:00 -0700
tags: [{"name":"download","id":3772747},{"name":"SQLServer","id":58671410}]
author: Jane Dallaway
alias: /tsqlunit-updates-helper-functions

<p>Last week I attended another <a href="http://jane.dallaway.com/tag/ilp">ILP</a> workshop, this time about <a href="http://www.nunit.org/index.php">nUnit</a>.  This made me remember about the <a href="http://tsqlunit.sourceforge.net/">TSQLUnit testing framework</a>, and the changes I had made to it whilst using it at my previous company and the fact that these changes were just sitting in a file somewhere and had never been shared.<p />The project which benefited from the most from TSQLUnit was one working with a large set of complicated calculations.  Due to the nature of the data, this work was carried out in the database layer.  These calculations were based on a well specified system, and so was a great candidate for thorough unit testing.  Whilst building the calculation engine, I enhanced the base TSQLUnit installation to have some additional helper functions to save me coding the same thing over and over again.<p />I added a set of value checking helper procedures as follows<br /><span class="code">tsu_CheckValues_Decimal, tsu_CheckValues_Int, tsu_CheckValues_String, tsu_CheckValues_Date, tsu_CheckValues_Money</span> all of which take 3 parameters - the first the expected data value, the second the actual data value, and the third an optional parameter expressing the message to be displayed to the developer if this assertion fails.<p />For example, <span class="code">EXEC tsu_CheckValues_Int 0,1,'Oops'<br /></span> results in the following error being recorded 'Integer value mismatch Oops - Unexpected Result.  Expected: 0.  Actual: 1'<p />In additon I added some helper functions to assist in the generation of error messages as follows<br /><span class="code">tsu_GenerateErrorMessage_Date, tsu_GenerateErrorMessage_Int, tsu_GenerateErrorMessage_Real, tsu_GenerateErrorMessage_String</span> all of which take 3 parameters, the first being the initial part of the message to display, the second the expected data value and the final the actual data value.<p />For example, <span class="code">SELECT dbo.tsu_GenerateErrorMessage_Int('Integer value mismatch',0,1)</span> which results in the following text being generated 'Integer value mismatch - Unexpected Result.  Expected: 0.  Actual: 1'<p />The helper functions do not alter or change the basis under which TSQLUnit operates, and so they should install and work happily within existing TSQLUnit installations.  Download the <a href="https://github.com/janedallaway/SQL-Server-Helper-Scripts/blob/master/TSQLUnitHelpers.sql">TSQLUnit Helper Functions</a>. <p />I have also provided a <a href="https://github.com/janedallaway/SQL-Server-Helper-Scripts/blob/master/TSQLUnitIntroductionTests.sql">script containing sample TSQLUnit tests</a> - one coded to pass, one coded to fail, both making use of the <span class="code">tsu_CheckValues_Int</span>. <p />In another post I will go into the other changes I made, and the recommendations for testing we came up with as a result of this exercise.</p>
