title: .NET and SQL Server - retrieving blobs
date: 2007/02/01 08:33:00 -0800
tags: [{"name":".NET","id":3773062},{"name":"SQLServer","id":3773063}]
author: Jane Dallaway
alias: /net-and-sql-server-retrieving-blobs

The database for my current project stores pdf documents as images within the database.  I needed to write a quick rough and ready program to retrieve all pdfs which meet a certain set of criteria.  <p />The main key is remembering that a <a href="http://msdn2.microsoft.com/en-US/library/ms188362.aspx">binary</a>, or <a href="http://msdn2.microsoft.com/en-US/library/ms174409.aspx">image</a> comes back as an array of bytes.  This enables us to make use of <span class="code">System.IO.File.WriteAllBytes</span> which takes in a <span class="code">string</span> parameter filePath representing the path to the file, and a <span class="code">byte[]</span> parameter representing the file.<p />I set up a data set, and defined a <span class="code">TableAdapter MyQueryTableAdapter</span> to have a <a href="http://msdn2.microsoft.com/en-us/library/ms171905(VS.80).aspx">parameterised query</a> as <span class="code">MyQuery</span> to extract the relevant fields, and then used:<p /><span class="code">MyProjectTableAdapters.MyQueryTableAdapter tableAdapter = new MyProject.MyProjectTableAdapters.MyQueryTableAdapter();<br />MyProject.MyQueryDataTable table;</span><p />to define table and tableAdapter variables.<br />These were then used to populate the table with data based upon myParameter.<p /><span class="code">table = tableAdapter.GetData(myParameter);</span><p />All I did then was loop through the <span class="code">table.Rows</span> in the <span class="code">table</span> and populate a <span class="code">byte[] myPdfDocument</span> variable for each row.  This myPdfDocument was then written using the above code.  <p />Job done.<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-6350072655052107621?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
