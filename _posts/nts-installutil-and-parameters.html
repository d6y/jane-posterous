title: NTS: InstallUtil and parameters
date: 2009/05/20 07:58:00 -0700
tags: [{"name":"NET","id":3772521},{"name":"nts","id":3772523}]
author: Jane Dallaway
alias: /nts-installutil-and-parameters

<p>Definitely under the <a href="http://jane.dallaway.com/tag/nts">note to self</a> category this one...<p />I've been working with installing a service and took the base code from our platform.  Part of the command line specifies a parameter to be used within the installer, but no matter what I did I could not get the parameter to be picked up.<p />An example of the installation command line is <br /><span class="code">"C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\installUtil.exe" "C:\Services\MyService.exe" /SERVICENAME="My Special Service"</span> <br />which, at least in theory, allows the service to be created so that in the Services dialog it is listed under the name "My Special Service"<p />A quick google with the right keywords and I stumbled across <a href="http://www.yankeeboysoftware.com/wordpress/?p=45">The curious case of InstallUtil and service parameters</a> which both explains the situation and provides a lovely working solution.<p />In my case, the code was even simpler than the example as I was specifically looking for only one parameter, the service name, and so my <span class="code">OnBeforeInstall</span> and <span class="code">OnBeforeUninstall</span> become<br /><span class="code"><br />protected override void OnBeforeInstall(System.Collections.IDictionary savedState)<br />{<br />&nbsp;&nbsp;&nbsp;base.OnBeforeInstall(savedState);<br />&nbsp;&nbsp;&nbsp;SetServiceNameFromCommandLineParameter();            <br />}<p />protected override void OnBeforeUninstall(System.Collections.IDictionary savedState)<br />{<br />&nbsp;&nbsp;&nbsp;base.OnBeforeUninstall(savedState);<br />&nbsp;&nbsp;&nbsp;SetServiceNameFromCommandLineParameter();            <br />}</span><p />where <span class="code">SetServiceNameFromCommandLineParameter</span> is :<p /><span class="code">void SetServiceNameFromCommandLineParameter()<br />{<br />&nbsp;&nbsp;&nbsp;const string SERVICE_NAME = "SERVICENAME";<p />&nbsp;&nbsp;&nbsp;String[] args = System.Environment.GetCommandLineArgs();<br />&nbsp;&nbsp;&nbsp;String no_log_file = null;<br />&nbsp;&nbsp;&nbsp;InstallContext tmp_ctx = new InstallContext(no_log_file, args);<p />&nbsp;&nbsp;&nbsp;string serviceName = tmp_ctx.Parameters[SERVICE_NAME];<p />&nbsp;&nbsp;&nbsp;if (serviceName == null)<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new ApplicationException(string.Format("{0} undefined", SERVICE_NAME));<br />&nbsp;&nbsp;&nbsp;}            <p /> //Set service name<br />&nbsp;&nbsp;&nbsp;this.serviceInstaller1.DisplayName = serviceName ;<br />&nbsp;&nbsp;&nbsp;this.serviceInstaller1.ServiceName = serviceName;<br />}</span><p />where <span class="code">serviceInstaller1</span> is defined as <span class="code">private ServiceInstaller serviceInstaller1;</span><p />As to why this works in the base code, but doesn't for mine I have no idea, but I have at least got it working now</p>
