title: SSIS Foreach Nodelist enumerators
date: 2006/08/09 05:40:00 -0700
tags: [{"name":"SQLServer","id":58673831}]
author: Jane Dallaway
alias: /ssis-foreach-nodelist-enumerators

I have some simple XML to parse within my SSIS package<p /><span class="code"><br />&lt;images&gt;<br />&nbsp;&nbsp;&lt;image&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;source&gt;8162_5260.JPG&lt;/source&gt;  <br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;destination&gt;87775588_01.JPG&lt;/destination&gt; <br />&nbsp;&nbsp;&lt;/image&gt;<br />&nbsp;&nbsp;&lt;image&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;source&gt;8162_5260_01.JPG&lt;/source&gt; <br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;destination&gt;87775588_02.JPG&lt;/destination&gt; <br />&nbsp;&nbsp;&lt;/image&gt;<br />&lt;/images&gt;<br /></span><p /><br />and I want to take an image and copy the physical image referred to by source to destination.  I knew I needed to use the foreach Nodelist enumerator, but I didn't really know where to start as the <a href="http://www.amazon.co.uk/gp/product/0764584359/ref=sr_11_1/202-5908120-8586210?ie=UTF8">book</a> I have on my desk doesn't seem to cover it at all.<p /><b>Attempt One</b><p />I found a useful article <a href="http://blogs.msdn.com/ashvinis/archive/2005/10/21/483690.aspx">SSIS Debugging foreach NodeList enumerators</a> which was a start, but didn't seem to get me where I wanted to be as with XPath settings of <p />Enumeration type: NodeText<br />OuterXPathString: /<p />mapping to a string variable named variable (original heh, but this was a proof on cencept) with index 0 I got data in the variable of 8162_5260.JPG87775588_01.JPG8162_5260_01.JPG87775588_02.JPG.  Right data, but not in a useable format.<p />With the XPath settings of<p />Enumeration type: ElementCollection<br />OuterXPathString: /images<br />InnerElementType: NodeText<br />InnerXPathString: *<p />my variable has the data 8162_5260.JPG87775588_01.JPG in it on the first, and worryingly only, iteration.  <p /><b>Attempt Two</b><p />Obviously doing something wrong, so I hit google again, and this time found a <a href="http://sqlug.be/blogs/drivenbysql/archive/2006/07/27/258.aspx">DrivenBySQL example</a>, which has pictures and everything (and it contains a link to <a href="http://weblogs.asp.net/nleghari/articles/visualxpath.aspx">Visual XPath</a>, which was a useful tool for validating my XPath statement).<p />So, I changed the XPath settings to be <p />OuterXPathString: /images/image<br />InnerElementType: Node<br />InnerXPathString: .<p />capturing the output in a variable of type Object<p />I then wrote some script to get the data from my XmlNode into 2 string variables, this script was heavily based upon the <a href="http://users.skynet.be/drivenbysql/Blogs/XmlForEachNodeList/step7_script.html">sample code</a> from the DrivenBySQL example but with the follwing definitions for string and destination based on the appropriate entites, rather than the attributes in the example<p /><span class="code"><br />  strSource = objNode.SelectSingleNode("source").InnerText.ToString<br />  strDest = objNode.SelectSingleNode("destination").InnerText.ToString<br /></span><p />All now seems to be working.  Hurrah!<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-115512364256245972?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
