title: TSQL - Getting the value from a stored procedure into a variable
date: 2006/08/10 05:36:00 -0700
tags: [{"name":"code","id":58671450},{"name":"SQLServer","id":58671460}]
author: Jane Dallaway
alias: /tsql-getting-the-value-from-a-stored-procedur

<a href="http://www.harriyott.com/index.aspx">Simon</a> popped over earlier to ask if I knew a way to capture the data within a SELECT returned as part of a stored procedure within TSQL.  So, the item he was after wasn't an output variable, neither was it the return value.  I remembered roughly how to do it, and then hunted through some of our <a href="http://tsqlunit.sourceforge.net/">TSQLUnit</a> tests to find an example to send to him.  I'd used temporary tables to do it.  I wondered why I'd use that instead of a table variable, so I thought I'd write a bit of code to find out.  The reason was that we got the error "EXECUTE cannot be used as a source when inserting into a table variable." <p /><span class="code">CREATE TABLE MyTest<br />(Test1 VARCHAR(20))<p />INSERT INTO MyTest<br />&nbsp;(Test1)<br />VALUES<br />&nbsp;('Hello')<p />CREATE PROCEDURE GetTest<br />AS<br />BEGIN<br />&nbsp;&nbsp;SELECT Test1 <br />&nbsp;&nbsp;FROM MyTest<br />END<p />DECLARE @tabCaptureTheResults TABLE (Data VARCHAR(20))<p />INSERT @tabCaptureTheResults<br />EXEC GetTest</span><p />This results in:<br /><span class="code">Server: Msg 197, Level 15, State 1, Line 4<br />EXECUTE cannot be used as a source when inserting into a table variable.</span><p /><span class="code">CREATE TABLE #CaptureTheResults (Data VARCHAR(20))<p />INSERT #CaptureTheResults<br />EXEC GetTest<p />SELECT * FROM #CaptureTheResults</span><p />This results in 'Hello' being returned, exactly as required.<br />Whilst this works, it isn't exactly going to be efficient.  Anyone know of any better ways of doing this within TSQL?<p />UPDATE:<br />As of SQL 2005 both cases seem to work - Hurrah!<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-115520988473256604?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
