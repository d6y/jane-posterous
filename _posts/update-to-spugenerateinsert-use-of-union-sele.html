title: Update to spu_generateinsert - use of UNION SELECT
date: 2008/01/23 11:52:00 -0800
tags: [{"name":"download","id":3772778},{"name":"SQLServer","id":58674280}]
author: Jane Dallaway
alias: /update-to-spugenerateinsert-use-of-union-sele

<p>Jon Green from 4R Systems Inc left a comment earlier proposing a suggested improvement to <a href="https://github.com/janedallaway/SQL-Server-Helper-Scripts/blob/master/spu_generateInsert.sql">spu_generateinsert</a>.<p />He suggested that it would be easier to scan the produced SQL if it made use of SELECT and UNION SELECT rather than producing a whole host of INSERT statements.  This changes the output from:<br /><span class="code">INSERT INTO [TableName] ([ColumnA], [ColumnB]) VALUES ('A','B')<br />INSERT INTO [TableName] ([ColumnA], [ColumnB]) VALUES ('C','D')</span><br />and replaces it with<br /><span class="code">INSERT INTO [TableName] ([ColumnA], [ColumnB]) <br />SELECT 'A','B'<br />UNION SELECT 'C','D'</span><p />This is a great suggestion and I have implemented it by the use of an additional parameter <span class="code">@producesingleinsert</span>.  By default this is set to 0 which produces the separate INSERT statements as it has done all along.  If it is specified as 1, however, it now produces a single statement making use of SELECT and UNION SELECT.  I have implemented this as an optional parameter so as not to break any reliance on this functionality.<p />I also made another change today which is to exclude calculated columns.  This has involved joining <span class="code">INFORMATION_SCHEMA.COLUMNS</span> to  <span class="code">syscolumns</span> via  <span class="code">sysobjects</span> to make use of  <span class="code">syscolumns.IsComputed</span>.  <p />The final change was the addition of another optional parameter <span class="code">@ debug</span>.  Again this defaults to 0, but if set to 1 prints out the SELECT clause which will be used to obtain the data.  This can help to debug problems with the procedure, both in terms of the internal logic, but also with regards to checking that the criteria specified is being handled correctly.<p />As ever this is work in progress, so please continue sending in your suggestions and I'll attempt to implement them.<p />Download the script from <a href="https://github.com/janedallaway/SQL-Server-Helper-Scripts/blob/master/spu_generateInsert.sql">here</a>.</p>
