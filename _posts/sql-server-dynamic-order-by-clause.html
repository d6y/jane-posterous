title: SQL Server - Dynamic Order by clause
date: 2007/08/21 05:11:00 -0700
tags: [{"name":"code","id":58678592},{"name":"SQLServer","id":58678591}]
author: Jane Dallaway
alias: /sql-server-dynamic-order-by-clause

I was just asked a question about a way of making the order by clause in a query alter according to a variable without having to build up the sql query as a string and EXEC it.<p />After a bit of a play we got it to work using similar code to the following<p /><span class="code">DECLARE @intOrder INT<br />SET @intOrder = 4<p />SELECT * <br />FROM Customers<br />ORDER BY<br />CASE @intOrder <br />&nbsp;WHEN 1 THEN CompanyName<br />&nbsp;WHEN 2 THEN ContactName<br />&nbsp;WHEN 3 THEN ContactTitle<br />&nbsp;WHEN 4 THEN Fax<br />END</span><br />where CompanyName, ContactName, ContactTitle and Fax are all character columns.<p />There is a condition.  The columns that are being potentially ordered by need to be of the same type, which means potentially <a href="http://doc.ddart.net/mssql/sql70/ca-co_1.htm">cast</a>ing columns.  And of course, remembering that an integer may be of a different length to others and so needs to be <a href="http://classicasp.aspfaq.com/general/how-do-i-pad-digits-with-leading-zeros.html">padded</a> to ensure that the comparison is appropriate.<p /><span class="code">DECLARE @intOrder INT<br />SET @intOrder = 3<p />SELECT * <br />FROM Employees<br />ORDER BY<br />CASE @intOrder <br />&nbsp;WHEN 1 THEN LastName<br />&nbsp;WHEN 2 THEN CONVERT(VARCHAR(20),BirthDate,121)<br />&nbsp;WHEN 3 THEN REPLACE(STR(ReportsTo, 10), SPACE(1), '0')<br />&nbsp;WHEN 4 THEN Title<br />END</span><br />where LastName and Title are character columns, BirthDate is a date - using format 121 to move it into ODBC canonical (with milliseconds) yyyy-mm-dd hh:mi:ss.mmm(24h) and ReportsTo is an integer<div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-7531275676186053130?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
