title: Review: Clone Detective
date: 2008/08/27 10:26:00 -0700
tags: [{"name":".NET","id":58673961},{"name":"review","id":3772635},{"name":"tool","id":3772633}]
author: Jane Dallaway
alias: /review-clone-detective

<p><a href="http://blog.cwa.me.uk/2008/08/20/the-morning-brew-162/">The Morning Brew #162</a> mentioned a tool <a href="http://www.codeplex.com/CloneDetectiveVS">Clone Detective</a> which</p>
<blockquote class="posterous_medium_quote">is a Visual Studio integration that allows you to analyze C# projects for source code that is duplicated somewhere else. Having duplicates can easily lead to inconsistencies and often is an indicator for poorly factored code.</blockquote>
<p><p />Today, a colleague and I spent some <a href="http://jane.dallaway.com/tag/ilp">ILP</a> time investigating the tool to determine whether it would help us in the <a href="http://madgex.com/">Madgex</a> environment or not.<p />We tried the tool out on a couple of projects, but due to it being a Visual Studio 2008 only plug-in our options were a bit limited.  After installing the plug-in, the next thing we did was watch the <a href="http://www.codeplex.com/CloneDetectiveVS/Wiki/View.aspx?title=Videos&amp;referringTitle=Home">video</a>. This gave us a good overview of how it works, and where to find it (hiding under View -&gt; Other Windows -&gt; Clone Explorer). During the video it explained that effectively this tool breaks code down into a series of tokens, and then looks for other pieces of code which can also be broken down into the same series of tokens. The terminology took a little while to get a grasp of - there are clones and there are clone classes. A clone class is a series of tokens which is/may be repeated throughout the solution. A clone is an instance of this fragment. So, if there was a line of code which did something like a = b + c, the clone class would be <span class="code">[var] = [var] + [var]</span>, and the clones could be lines of code which are <span class="code">a = b + c</span> or <span class="code">d = e + f</span> (irrespective of whitespace or variable names etc).<p />It works across an entire solution, so we set it running and looked at the clones it found. Unfortunately, a lot of the clones that were detected for us were false positives - like properties which when tokenised are the same, but which can't really be re-factored. Additionally, some of the clone classes that it detected, are actually multiple presentations of the same code. For instance, one file I looked at had the following lines all marked as clones of different clone classes:</p>
<ul>
<li>lines 20 - 43</li>
<li>lines 20 - 59</li>
<li>lines 24 - 43</li>
<li>lines 24 - 44</li>
<li>lines 37 - 59</li>
</ul>
<p>which basically tells us that the area of code from lines 20 - 59 should be re-factored into (probably) one new piece of code which can then be re-analysed to find out if other re-factorings are also worthwhile.<p />The interface is easy to get to grips with, and is accessed either via its own panels (Clone Explorer, Clone Intersections and Clone Results) or by an indication in the code window with a context sensitive menu item Find Clones, or Show Clone Intersections. Clicking on an item in the explorer allows you to navigate into more detail and find the clone class or find all instances of it. In a big solution, with a lot of clones (false positives or otherwise) the right click to get clone class listing can take quite a while - in the order of 10 - 20 seconds - which can result in lots of re-right-clicking when one is impatient. This may indicate a problem with scalability.<p />The tool would have proved a lot more useful to us with a few extras:</p>
<ul>
<li>Ability to ignore properties</li>
<li>Ability to list all clone classes at once, rather than having to right click on a file in the Clone Explorer and choose Show Clone Intersections. Then picking a file in there and right clicking to select Clone Class x -&gt; Find All Occurrences</li>
<li>Ability to mark clone classes as "ignore" so it doesn't report on them again</li>
</ul>
<p><br />So, our summary is, a nice idea but gives too many false positives and isn't refined enough at the moment to be of use within our environment on a regular basis. It may, however, still be useful as a one-off exercise (with patience) to find the key areas that should be addressed. In a less complex code base it might be worth another look. Additionally, if when working on some code we detect something that looks like its been copied and pasted, then it might well be worth running Clone Explorer to find other areas that could benefit from our refactoring.<p />This leaves us with the question, how else can we detect clones in our code base? Until we find something else, this is better than nothing.  Does anyone have any suggestions of other tools which could address this area?</p>
