title: ASP.NET: validators and client code
date: 2007/01/17 06:40:00 -0800
tags: [{"name":".NET","id":58672354}]
author: Jane Dallaway
alias: /aspnet-validators-and-client-code

I found myself with a bit of a challenge yesterday.  I have a form which has client validation but also has a message displayed back from the server after a save.<p />When a save happens a "Update successful" message is displayed on the screen as an &lt;asp:label&gt;.<p />When the client side validation happens, then one of many error messages are displayed on the screen.<p />This means that both the "Update successful" and the error messages are displayed on the screen at the same time.  This obviously isn't ideal and doesn't give the user a clear message.<p />For a while I was going to do this using a &lt;<a href="http://aspnet.4guysfromrolla.com/articles/073102-1.aspx">asp:customvalidator</a>&gt; calling some javascript to clear out the label.  And then I read "The custom validation subroutine is not called when the control being validated does not contain any data.  The only control that you can use to check for an empty form field is the RequiredFieldValdiator control" which scuppered those plans.<p />I then did a bit of googling and discovered that I could use the Attributes property to get at the <a href="http://msdn2.microsoft.com/en-us/library/aa479302.aspx">client side events</a> of an element.  So, a bit of code that does <br /><span class="code">TextBox1.Attributes["onblur"] = "for(i=0; i&lt;document.all.length; i++){if (document.all[i].id.indexOf('Label1') &gt; -1) { var element = document.all[i];element.innerHTML='Changes have been made';};}";</span><br />works like a charm and when focus leaves TextBox1, the text in the element Label1 changes to be "Hello".<p />I then manipulated it a bit more and discovered that if in the html the Label1 element is set to visible="false", then the javascript fails due to the non-existance of that element. <p />So, the final result is:<p />The basic form:<br /><div class='p_embed p_image_embed'>
<img alt="" src="http://www.janeandrichard.co.uk/jane/200701basicform.JPG" />
</div>
<p />When a required field is missing (note both the validator text and the change of text in the label caused by changing the focus):<br /><div class='p_embed p_image_embed'>
<img alt="" src="http://www.janeandrichard.co.uk/jane/200701requiredfieldvalidator.JPG" />
</div>
<p />When the two textboxes don't have identical content:<br /><div class='p_embed p_image_embed'>
<img alt="" src="http://www.janeandrichard.co.uk/jane/200701comparevalidator.JPG" />
</div>
<p />With asp code of:<br /><span class="code"><br />&lt;asp:Label ID="Label1" runat="server" Text="Label"&gt;Please make some changes&lt;/asp:Label&gt;<br />&lt;br /&gt;<br />&lt;asp:TextBox ID="TextBox1" runat="server"&gt;TextBox1&lt;/asp:TextBox&gt;<br />&lt;asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" ErrorMessage="RequiredFieldValidator" ControlToValidate="TextBox1" Text="RequiredFieldValidator"&gt;&lt;/asp:RequiredFieldValidator&gt;<br />&lt;br /&gt;<br />&lt;asp:TextBox ID="TextBox2" runat="server"&gt;TextBox2&lt;/asp:TextBox&gt;<br />&lt;asp:CompareValidator ID="CompareValidator1" runat="server" ErrorMessage="CompareValidator" ControlToCompare="TextBox2" ControlToValidate="TextBox1"&gt;CompareValidator&lt;/asp:CompareValidator>&lt;br/&gt;<br />&lt;asp:Button ID="Button1" runat="server" Text="Button" /&gt;<br /></span><p />and a code behind of<br /><span class="code"><br />protected void Page_Load(object sender, EventArgs e)<br />&nbsp;{<br />&nbsp;&nbsp;if (Label1.Visible)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;TextBox1.Attributes["onblur"] = "for(i=0; i -1) { var element = document.all[i];element.innerHTML='Changes have been made';};}";<br />&nbsp;&nbsp;}<br />&nbsp;}<br /></span><div class="blogger-post-footer"><img class="posterous_download_image" src="https://blogger.googleusercontent.com/tracker/14400377-2159835103385342920?l=jane.dallaway.com%2Fblog%2Fblog.html" height="1" alt="" width="1" /></div>
